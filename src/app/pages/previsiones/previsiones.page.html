<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Previsión de carga de edificio con IRVE</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <mat-grid-list cols="6" rowHeight="50px">
    @for (tile of tiles; track tile) {
    <mat-grid-tile [colspan]="tile.cols" [rowspan]="tile.rows"
      [style.background]="tile.color">{{tile.text}}</mat-grid-tile>
    }
  </mat-grid-list>

  <ion-grid>
    <ion-row>
      <ion-col class="ion-justify-content-start">

        <ion-label>Esquema:</ion-label>
        <ion-select aria-label="tipo de esquema" interface="popover" placeholder="tipo de esquema" color="danger"
          (ionChange)="cambiaEsquema($event.srcElement)">
          <ion-select-option value="1a">1a</ion-select-option>
          <ion-select-option value="1b">1b</ion-select-option>
          <ion-select-option value="1c">1c</ion-select-option>
          <ion-select-option value="2">2</ion-select-option>
          <ion-select-option value="3a">3a</ion-select-option>
          <ion-select-option value="4a">4a</ion-select-option>
          <ion-select-option value="4b">4b</ion-select-option>

        </ion-select>

      </ion-col>
      <ion-col>
        <ion-checkbox (ionChange)="cambiaSPL ($event.target.checked)">¿Tiene SPL?:</ion-checkbox>

      </ion-col>
    </ion-row>
  </ion-grid>
  <ion-item-group>
    <ion-item-divider color="primary">
      <ion-label>Prevision Viviendas </ion-label><ion-label slot="end">
        {{this.previsionesService.prevision().Pviv.toFixed(3)}} kW </ion-label>
        <ion-button id="click-triggertv" slot="end"><ion-icon name="information"></ion-icon></ion-button>
      <ion-popover  trigger="click-triggertv" triggerAction="click">
        <ng-template id="contentpop">
          <ion-content   class="ion-padding"><ion-img src="../../../assets/tipoVivienda2.png"  > </ion-img></ion-content>
        </ng-template>
      </ion-popover>
    </ion-item-divider>




    <!--Creamos la tabla para listar las viviendas -->
    <div id="divTabla">
      <table mat-table [dataSource]="this.previsionesService.listaViviendas()" class="mat-elevation-z8 tablaViv">
        <!-- Columna de ID
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef> ID </th>
          <td mat-cell *matCellDef="let element"> {{element.id}} </td>
          <td mat-footer-cell *matFooterCellDef class="columnaResultado"></td>
        </ng-container>
 -->
        <ng-container matColumnDef="numViviendas">
          <th mat-header-cell *matHeaderCellDef> Num Viv: </th>
          <td mat-cell *matCellDef="let element">{{element.numViviendas}} </td>
          <td mat-footer-cell *matFooterCellDef class="columnaResultado">Total
            Viv:{{this.previsionesService.numTotalViviendas()}} </td>
        </ng-container>
<!--  
        <ng-container matColumnDef="tipo.nombre">
          <th mat-header-cell *matHeaderCellDef>Tipo viv:</th>
          <td mat-cell *matCellDef="let element">{{element.tipo.nombre}} </td>
          <td mat-footer-cell *matFooterCellDef class="columnaResultado"> Pot media: </td>
        </ng-container>
-->
        <ng-container matColumnDef="tipo.potencia">
          <th mat-header-cell *matHeaderCellDef> Potencia Vivienda kW </th>
          <td mat-cell *matCellDef="let element">{{element.tipo.nombre}}{{element.tipo.potencia}} </td>
          <td mat-footer-cell *matFooterCellDef class="columnaResultado">
            Pot media: {{this.previsionesService.sumPotP1med().toFixed(3)}}</td>
        </ng-container>

        <ng-container matColumnDef="conIrve">
          <th mat-header-cell *matHeaderCellDef> Viviendas con Irve </th>
          <td mat-cell *matCellDef="let element">{{element.conIrve}} </td>
          <td mat-footer-cell *matFooterCellDef class="columnaResultado"> CS:
            {{this.previsionesService.cs().toFixed(3)}}</td>
        </ng-container>

        <ng-container matColumnDef="potIrve">
          <th mat-header-cell *matHeaderCellDef> Potencia Irve kW </th>
          <td mat-cell *matCellDef="let element">{{element.potIrve}} </td>
          <td mat-footer-cell *matFooterCellDef class="columnaResultado"> Total conjunto viviendas:</td>
        </ng-container>

        <ng-container matColumnDef="total">
          <th mat-header-cell *matHeaderCellDef> Total potencia Irve kW</th>
          <td mat-cell *matCellDef="let element">
            {{((element.numViviendas-element.conIrve!)*element.tipo.potencia+(element.conIrve!*(element.tipo.potencia+0.3*element.potIrve!))).toFixed(2)}}
          </td>
          <td mat-footer-cell *matFooterCellDef class="columnaResultado">
            {{(this.previsionesService.sumPotP1med()*this.previsionesService.cs()).toFixed(2)}}</td>
        </ng-container>

        <ng-container matColumnDef="ion-button">
          <th mat-header-cell *matHeaderCellDef>Eliminar</th>
          <td mat-cell *matCellDef="let element"><ion-button class="btnElimina"
              (click)="eliminaVivienda(element)"><ion-icon slot="icon-only" name="trash"></ion-icon></ion-button></td>
          <td mat-footer-cell *matFooterCellDef class="columnaResultado"> </td>

        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumnsViv"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumnsViv;"></tr>
        <tr mat-footer-row *matFooterRowDef="columnaResultado"></tr>


      </table>
    </div>
    @for (item of previsionesService.listaViviendas(); track item.id) {

    @if (item.id==0){



    }


    } @empty {
    <li>No hay ninguna vivienda definida.</li>
    }


    <ion-col color="danger"><ion-button id="btnAgregarViv" color="danger" (click)="agregarVivienda()" expand="block" fill="clear" 
        shape="round" >
        Agregar viviendas
      </ion-button>
    </ion-col>

  </ion-item-group>

  <ion-item-group>
    <ion-item-divider color="secondary">
      <ion-label>Prevision Sevicios Generales  Pasc: {{this.previsionesService.Pasc().toFixed(3)}} kW Pgm: {{this.previsionesService.Pgm().toFixed(3)}} kW Palum: {{this.previsionesService.PAlum()|number}}</ion-label>
      <ion-button id="click-trigger" slot="end"><ion-icon name="information"></ion-icon></ion-button>
      <ion-popover trigger="click-trigger" triggerAction="click">
        <ng-template>
          <ion-content class="ion-padding"><ion-img src="../../../assets//Psergen.png"> </ion-img></ion-content>
        </ng-template>
      </ion-popover>
    </ion-item-divider>


    <ion-col><ion-button color="secondary" (click)="agregarServGrales()" expand="block" fill="clear" shape="round">
        Agregar/Eliminar Servicios Generales
      </ion-button></ion-col>

    <!-- Prueba 1 listado ascensor
      <ion-col>
        <div #listadoAsc class="box">
          @for (ascItem of this.previsionesService.listaAscensores(); track ascItem.id) {
          <li>
            <div class="row flex-container boxAsc ">
              <div class="row ">
                <div class="col-xs-3"></div>
                ID: {{ ascItem.id }} Num ascensores:{{ ascItem.numAscensores }}
    
                Tipo  {{ ascItem.tipoMotorAsc }} de {{ ascItem.potenciaMotorAsc }}-{{ ascItem.medidaPotencia }}
                <input type="button" class="btn ion-button"><ion-icon name="trash"></ion-icon>
              </div>
              <br>
            </div>
          </li>
          } @empty {
          <li>No hay ningún servicio general definido.</li>
          }
    
    
        </div>
      </ion-col>
      -->
    
    <!---- Prueba 2 listado ascensor -->
      <ion-grid>
      <ion-row>
        @for (ascItem of this.previsionesService.listaAscensores(); track ascItem.id) {
        <ion-col size="12" size-xs="12" size-sm="6" size-md="4" size-lg="3"
          >
          <img alt="Icono Ascensor" src="../../../assets/icon/ascensor.png" height="50px" class="ion-float-right" />
          {{ascItem.numAscensores}} ascensores tipo {{ascItem.tipoMotorAsc}} de {{ascItem.potenciaMotorAsc}} {{ascItem.medidaPotencia}}.
          Total {{ascItem.totalpotenciakw |number}} kW.
          <div class="btn ion-button btnBorrar"
              (click)="this.eliminaAscensor(ascItem)"><ion-icon name="trash"></ion-icon>
          </div>
        </ion-col>
      } @empty {
        <li>No hay ningún ascensor definido.</li>
        }
      </ion-row>
    </ion-grid>

    <!------- Prueba 3 listado Asc----
      <ion-grid>
        <ion-row>
          <ion-col>
           
            <img
              alt="Silhouette of a person's head"
              src="../../../assets/icon/Grupomoto1.png"
              height="20px"
            />
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ac vehicula lorem.
          </ion-col>
          <ion-col>
           
            <img
              alt="Silhouette of a person's head"
              src="../../../assets/icon/Alumbrado1.png"
              height="20px"
              class="ion-float-left"
            />
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed ac vehicula lorem.
          </ion-col>
          @for (ascItem of this.previsionesService.listaAscensores(); track ascItem.id) {
          <ion-col>
            
            <img
              alt="Silhouette of a person's head"
              src="../../../assets/icon/ascensor.png"
              height="20px"
              class="ion-float-right"
            /><br>
            {{ascItem.numAscensores}} ascensores tipo  {{ascItem.tipoMotorAsc}} de  {{ascItem.potenciaMotorAsc}}. 
              Total  {{ascItem.totalpotenciakw |number}} kW. 
          </ion-col>
        } @empty {
          <li>No hay ningún ascensor definido.</li>
          }
        </ion-row>
      </ion-grid> 
      --->

     <!---Listado de guupo motor  -->
      <ion-grid>
        <ion-row>
          @for (gmItem of this.previsionesService.listaGMotor(); track gmItem.id) {
          <ion-col size="12" size-xs="12" size-sm="6" size-md="4" size-lg="3"
            >
            <img alt="Icono Grupo Motor" src="../../../assets/icon/grupomotor3.png" height="50px" class="ion-float-right" />
            {{gmItem.numGMotores}} grupo motor  de {{gmItem.potenciaGMotor}} {{gmItem.medidaPotencia}}.
            Total {{gmItem.totalpotenciakw |number}} kW.
            <div class="btn ion-button btnBorrar"
                (click)="this.eliminaGrupoMotor(gmItem)"><ion-icon name="trash"></ion-icon>
            </div>
          </ion-col>
        } @empty {
          <li>No hay ningún ascensor definido.</li>
          }
        </ion-row>
      </ion-grid>
      <ion-grid>
        <ion-row>
          @for (itemAlum of this.previsionesService.listaAlumbrado(); track itemAlum.id) {
          <ion-col size="12" size-xs="12" size-sm="6" size-md="4" size-lg="3">
            <img alt="Icono Alumbrado" slot="start" src="../../../assets/icon/Alumbrado1.png" height="50px" class="ion-float-right" />
           id:{{itemAlum.id}} - {{itemAlum.mtsAlumbrado}} mts de {{itemAlum.tipoAlumbrado!.potAlum}} {{itemAlum.tipoAlumbrado!.nombreAlum!}} <br>
            {{itemAlum.numLamparas}} lamparas de {{itemAlum.potLamparas}}{{itemAlum.medidaPotencia}} 
            

            Total {{itemAlum.totalPotenciaAlumkW! |number}} kW.
            <div class="btn ion-button btnBorrar"
                (click)="this.eliminaAlumbrado(itemAlum)"><ion-icon name="trash"></ion-icon>
            </div>
          </ion-col>
        } @empty {
          <li>No hay ningún alumbrado definido.</li>
          }
        </ion-row>
      </ion-grid>
  </ion-item-group>

  <ion-item-group>
    <ion-item-divider color="tertiary">
      <ion-label>Prevision Locales</ion-label>
    </ion-item-divider>
    <ion-col><ion-button (click)="agregarLocales()" expand="block" fill="clear" shape="round">
        Agregar Locales
      </ion-button></ion-col>
  </ion-item-group>

  <ion-item-group>
    <ion-item-divider color="secondary">
      <ion-label>Prevision Garage</ion-label>
    </ion-item-divider>
    <ion-col><ion-button (click)="agregarGarage()" expand="block" fill="clear" shape="round">
        Agregar Garage
      </ion-button></ion-col>
  </ion-item-group>

  <ion-item-group>
    <ion-item-divider color="primary">
      <ion-label>Prevision Irve</ion-label>
    </ion-item-divider>
    <ion-item *ngFor="let irve of previsionesService.listaIrve()">
      <ion-label>{{irve.id}}</ion-label>
      <ion-label>Num Irves :{{irve.cantidad}}</ion-label>

      <ion-label>Potencia : {{irve.potencia}}</ion-label>
      <ion-label>Potencia vivienda :{{irve.tipoVivienda.potencia}} kW</ion-label>
      <ion-label>={{(irve.cantidad*irve.potencia)|number}} kW</ion-label>

    </ion-item>


  </ion-item-group>

</ion-content>